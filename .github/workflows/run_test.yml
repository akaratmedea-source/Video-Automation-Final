name: Run Notebook via Python (Stable Method)

on:
  workflow_dispatch:

jobs:
  run-notebook:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Set up Python Environment
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Install required dependencies
      run: |
        # تثبيت الأدوات اللازمة لتحويل وتنفيذ دفاتر Jupyter/Colab، بالإضافة إلى PyDrive2 للمصادقة على Drive
        pip install jupyter nbformat nbconvert pydrive2

    # خطوة المصادقة الآلية: كتابة المفتاح السري في ملف مؤقت (key.json)
    - name: Prepare Service Account Key File
      run: |
        echo '${{ secrets.GOOGLE_CREDS }}' > key.json

    # خطوة التنفيذ الحاسمة: تحويل الملف وتشغيله كسكريبت Python عادي
    - name: Execute Notebook as Python Script
      run: |
        # 1. تحويل ملف .ipynb إلى ملف python عادي .py
        jupyter nbconvert --to python test_automation.ipynb
        # 2. تشغيل الملف الناتج.
        python test_automation.py
